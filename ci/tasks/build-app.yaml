platform: linux
inputs:
  - name: app-repo
outputs:
  - name: app-build
caches:
  - path: .npm
run:
  path: sh
  args:
    - -c
    - |
      set -ex
      export npm_config_cache="$(pwd)/.npm"
      npm set progress=false
      pushd app-repo
        npm install
        ls -al dapp/
      popd
      cp -fa app-repo/Dockerfile app-build/
      cp -fa app-repo/dapp/ app-build/
      mkdir -p app-build/.git/
      cp -fa app-repo/.git/ref app-build/.git/
